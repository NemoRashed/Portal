<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link rel="icon" href="/images/favicon.png" />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet" href="/stylesheets/transaction.css" />
  </head>
  <body>
    <%- include('./header.ejs') %>
    <h1>Transaction</h1>

    <form
      class="transaction card"
      action="/transaction"
      method="POST"
      autocomplete="on"
    >
      <!--Repair-->
      <section>
        <label for="repair">Repair</label>
        <input
          name="repair"
          type="text"
          autocomplete="repair"
          autofocus
          required
        />
      </section>
      <!--total-->
      <section>
        <label for="total">Total</label>
        <input
          name="total"
          type="number"
          autocomplete="total"
          autofocus
          required
        />
      </section>
      <!-- Part -->
      <section>
        <label for="part">Part Cost</label>
        <input
          name="part"
          type="number"
          autocomplete="part"
          autofocus
          required
        />
      </section>

          <!-- Payment Method -->
          <section>
            <label for="method">Payment Method</label>
            <input
              name="method"
              type="text"
              autocomplete="part"
              autofocus
              required
            />
          </section>
      <!-- Profit -->
      <input type="hidden" name="profit" value="unknown" />

      <!-- Location -->
      <section>
        <p>Select Location</p>
        <input type="radio" value="West Seattle" name="location" required />
          <label for="West Seattle">West Seattle</label><br />

        <input type="radio" value="Ballard" name="location" required />
          <label for="Ballard">Ballard</label><br />

        <input type="radio" value="North Seattle" name="location" required />
          <label for="North Seattle">North Seattle</label><br />
      </section>

      <!--Date-->
      <section>
        <label for="date">Date</label>
        <input name="date" type="date" autocomplete="date" autofocus required />
      </section>
      <!--User-->
      <input type="hidden" name="user" value= <%=currentUser.username %> />

      <button type="submit">Record Transaction</button>
    </form>


<aside>

  <button class="accordion">Date</button>
  <div class="panel">
    <p>West Seattle</p>
    <p>Ballard</p>
    <p>North Seattle</p>
  </div>


<button class="accordion">Location</button>
<div class="panel">
  <button>All</button>
  <button>West Seattle</button>
  <button>Ballard</button>
  <button>North Seattle</button>
</div>

</aside>



<script>
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    /* Toggle between adding and removing the "active" class,
    to highlight the button that controls the panel */
    this.classList.toggle("active");

    /* Toggle between hiding and showing the active panel */
    var panel = this.nextElementSibling;
    if (panel.style.display === "block") {
      panel.style.display = "none";
    } else {
      panel.style.display = "block";
    }
  });
}
</script>








    <!-- Table -->
    <table class="data">
      <tr>
        <th>Repair</th>
        <th>Total</th>
        <th>Part</th>
        <th>Profit</th>
        <th>Location</th>
        <th>User</th>
        <th>Date</th>
        <% if(currentUser && currentUser.isAdmin == 'true'){ %>

        <th>Admin</th>
        <% } %>

      </tr>
      <% if (transactions.length > 0){ %> 
        <% transactions.forEach(tran => { %>
    
        <tr class="data-piece">
          <td><%= tran.repair %></td>
          <td><%= tran.total %></td>
          <td><%= tran.part %></td>
          <td><%= tran.profit %></td>
          <td><%= tran.location %></td>
          <td><%= tran.user %></td>
          <td><%= tran.date %></td>

          <% if(currentUser && currentUser.isAdmin == 'true'){ %>
            <td>
            <button class="delete" data-transaction= <%= tran._id %>> Delete
          </button>
          </td>
        </tr>
          <% } %>
       
    
      <% }) %> <% } else { %>
      <p>There are no transactions to display</p>
      <% } %>
      </table>

    <script>
      const deleteBTN = document.getElementsByClassName("delete");
      for (let i = 0; i < deleteBTN.length; i++) {
        deleteBTN[i].addEventListener("click", (e) => {
          const endpoint = "/delete/" + deleteBTN[i].dataset.transaction;
          fetch(endpoint, { method: "DELETE" })
            .then((response) => response.json())
            .then((data) => (window.location.href = data.redirect))
            .catch((err) => console.log(err));
        });
      }
    </script>
  </body>
</html>

<!-- currentUser is the same as user.username -->
